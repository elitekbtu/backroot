# Universal Nginx Configuration Guide

## üéØ –ß—Ç–æ —ç—Ç–æ?

**–û–¥–∏–Ω nginx.conf —Ñ–∞–π–ª** –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π! –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **–õ–æ–∫–∞–ª—å–Ω–æ**: `http://localhost` (–±–µ–∑ SSL, –±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ**: `https://theb2r.com` (—Å SSL, –ø–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
./switch-mode.sh local

# Production –¥–µ–ø–ª–æ–π
./switch-mode.sh prod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
./switch-mode.sh status
```

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ `server_name`:

```nginx
# –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ theb2r.com –∏–ª–∏ www.theb2r.com ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
if ($host ~ ^(theb2r\.com|www\.theb2r\.com)$) {
    return 301 https://$host$request_uri;
}

# –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ localhost ‚Üí –æ–±—Å–ª—É–∂–∏–≤–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é –ø–æ HTTP
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
frontend/
‚îî‚îÄ‚îÄ nginx.conf              # ‚≠ê –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ–≥–æ

docker-compose.yml          # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ)

# –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
switch-mode.sh              # üéõÔ∏è  –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (local/prod)
init-letsencrypt.sh         # üîí –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SSL
ssl-renew.sh               # üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
check-ssl.sh               # üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
./switch-mode.sh local

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
docker-compose up -d
```

**–î–æ—Å—Ç—É–ø:**
- üåê http://localhost - –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üîå http://localhost/api - backend API  
- üîÑ ws://localhost/ws - WebSockets

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ localhost:**
- ‚úÖ HTTP (–±–µ–∑ SSL, –±—ã—Å—Ç—Ä–æ)
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)
- ‚úÖ CORS —Ä–∞–∑—Ä–µ—à–µ–Ω
- ‚ùå –ù–µ—Ç security headers
- ‚ùå –ù–µ—Ç rate limiting

## üåê Production –¥–µ–ø–ª–æ–π

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ email –≤ init-letsencrypt.sh (—Å—Ç—Ä–æ–∫–∞ 13)
nano init-letsencrypt.sh

# –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
./switch-mode.sh prod

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
./init-letsencrypt.sh
```

**–î–æ—Å—Ç—É–ø:**
- üåê https://theb2r.com - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç
- üîí https://www.theb2r.com - —Å www

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ production:**
- ‚úÖ HTTPS —Å Let's Encrypt
- ‚úÖ HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç  
- ‚úÖ Security headers (HSTS, CSP, etc.)
- ‚úÖ Rate limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫)
- ‚úÖ –î–ª–∏–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (1 –≥–æ–¥)
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
./switch-mode.sh local

# Production
./switch-mode.sh prod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
./switch-mode.sh status
./switch-mode.sh        # —Ç–æ –∂–µ —Å–∞–º–æ–µ
```

### –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# üéõÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
./switch-mode.sh local    # –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
./switch-mode.sh prod     # Production –¥–µ–ø–ª–æ–π

# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
./check-ssl.sh           # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—ë
./check-ssl.sh local     # –¢–æ–ª—å–∫–æ localhost
./check-ssl.sh prod      # –¢–æ–ª—å–∫–æ production

# üîí SSL —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
./init-letsencrypt.sh    # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
./ssl-renew.sh           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP
curl -I http://localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏
curl -I http://localhost/coin.glb
```

### Production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ HTTP ‚Üí HTTPS
curl -I http://theb2r.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -I https://theb2r.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
./check-ssl.sh
```

## üìä –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏

| –§—É–Ω–∫—Ü–∏—è | Localhost | Production |
|---------|-----------|------------|
| –ü—Ä–æ—Ç–æ–∫–æ–ª | HTTP | HTTPS |
| –ü–æ—Ä—Ç | 80 | 80 ‚Üí 443 |
| SSL | ‚ùå | ‚úÖ |
| Security Headers | ‚ùå | ‚úÖ |
| Rate Limiting | ‚ùå | ‚úÖ |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | 1 —á–∞—Å | 1 –≥–æ–¥ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –ë–∞–∑–æ–≤–æ–µ | –î–µ—Ç–∞–ª—å–Ω–æ–µ |
| ACME Challenge | ‚ùå | ‚úÖ |
| IP –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | ‚ùå | ‚úÖ |

## üîß –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω

–í `nginx.conf` –Ω–∞–π–¥–∏—Ç–µ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ:

```nginx
server_name localhost theb2r.com www.theb2r.com your-new-domain.com;

if ($host ~ ^(theb2r\.com|www\.theb2r\.com|your-new-domain\.com)$) {
    return 301 https://$host$request_uri;
}
```

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```nginx
# –î–ª—è localhost
set $cache_time "2h";  # –±—ã–ª–æ 1h

# –î–ª—è production
if ($host ~ ^(theb2r\.com|www\.theb2r\.com)$) {
    set $cache_time "6M";  # –±—ã–ª–æ 1y
}
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ API endpoints

```nginx
location /api/v2/ {
    proxy_pass http://backend:8000;
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}
```

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**:
   ```bash
   # –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS default_server –±–ª–æ–∫
   # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dev –≤–µ—Ä—Å–∏—é
   docker-compose -f docker-compose.dev.yml up -d
   ```

2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤**:
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã
   netstat -tulpn | grep :80
   netstat -tulpn | grep :443
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
docker-compose -f docker-compose.dev.yml ps

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose -f docker-compose.dev.yml logs backend
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ production

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig theb2r.com

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
./check-ssl.sh

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
./init-letsencrypt.sh
```

## üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–û–¥–∏–Ω –∫–æ–Ω—Ñ–∏–≥** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - nginx —Å–∞–º –ø–æ–Ω–∏–º–∞–µ—Ç –≥–¥–µ –æ–Ω –∑–∞–ø—É—â–µ–Ω
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - production –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ security features
4. **–£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - localhost —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ SSL
5. **–õ–µ–≥–∫–∏–π –¥–µ–ø–ª–æ–π** - –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ñ–∏–≥ –≤–µ–∑–¥–µ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è! üöÄ
