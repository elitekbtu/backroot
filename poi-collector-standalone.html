<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POI Collector - –°–±–æ—Ä –∫–æ–∏–Ω–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjXEeoTqkwQ2sidjXGsErUfobmBI1gXqg&libraries=places&callback=initMap"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -30px, 0);
            }
            70% {
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0, -4px, 0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                üèÜ POI Collector
            </h1>
            <p class="text-lg text-gray-600">
                –°–æ–±–∏—Ä–∞–π—Ç–µ –∫–æ–∏–Ω—ã, –ø–æ—Å–µ—â–∞—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ!
            </p>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
            <span id="notification-text"></span>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <div class="text-3xl font-bold text-indigo-600 mb-2">üí∞</div>
                <div id="coins" class="text-2xl font-bold text-gray-800">0</div>
                <div class="text-gray-600">–ö–æ–∏–Ω–æ–≤</div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <div class="text-3xl font-bold text-green-600 mb-2">üìç</div>
                <div id="location-info" class="text-sm text-gray-600">
                    –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <div class="text-3xl font-bold text-purple-600 mb-2">üèÜ</div>
                <div id="collected-count" class="text-2xl font-bold text-gray-800">0</div>
                <div class="text-gray-600">–ú–µ—Å—Ç –ø–æ—Å–µ—â–µ–Ω–æ</div>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">
                        –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
                    </h2>
                    <p id="tracking-status" class="text-gray-600">
                        –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ" –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–∏–Ω–æ–≤
                    </p>
                </div>
                
                <div class="flex gap-2">
                    <button id="start-tracking" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                        üöÄ –ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
                    </button>
                    <button id="stop-tracking" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors hidden">
                        ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <div id="location-error" class="mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden">
                <span id="error-text"></span>
            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–∞ —Å POI -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å —Ç–æ—á–∫–∞–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞
            </h2>
            
            <div id="map" class="w-full h-96 rounded-lg overflow-hidden shadow-lg mb-4"></div>
            
            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                    <span>–ù–µ –ø–æ—Å–µ—â–µ–Ω–æ</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                    <span>–ë–ª–∏–∑–∫–æ (‚â§50–º)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span>–°–æ–±—Ä–∞–Ω–æ</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                    <span>–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</span>
                </div>
            </div>
        </div>

        <!-- –ë–ª–∏–∂–∞–π—à–∏–µ POI -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                üìç –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ—Å—Ç–∞
            </h2>
            
            <div id="poi-list" class="space-y-3">
                <div class="text-center text-gray-500 py-8">
                    –í–∫–ª—é—á–∏—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –º–µ—Å—Ç
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div class="mt-8 bg-blue-50 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-blue-800 mb-3">
                üìã –ö–∞–∫ –∏–≥—Ä–∞—Ç—å
            </h3>
            <ul class="text-blue-700 space-y-2">
                <li>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</li>
                <li>‚Ä¢ –ü–æ–¥–æ–π–¥–∏—Ç–µ –∫ –ª—é–±–æ–π —Ç–æ—á–∫–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –±–ª–∏–∂–µ —á–µ–º –Ω–∞ 50 –º–µ—Ç—Ä–æ–≤</li>
                <li>‚Ä¢ –ü–æ–ª—É—á–∏—Ç–µ +10 –∫–æ–∏–Ω–æ–≤ –∑–∞ –∫–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ</li>
                <li>‚Ä¢ –ö–∞–∂–¥–æ–µ –º–µ—Å—Ç–æ –º–æ–∂–Ω–æ –ø–æ—Å–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑</li>
                <li>‚Ä¢ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
            </ul>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ POI –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤
        const POI_DATA = [
            // –ê–°–¢–ê–ù–ê (30 –º–µ—Å—Ç)
            { id: 'astana-1', name: 'Baiterek Tower', lat: 51.1283, lng: 71.4305, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-2', name: 'Hazrat Sultan Mosque', lat: 51.125636, lng: 71.471892, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-3', name: 'Ak Orda Presidential Palace', lat: 51.12583, lng: 71.44639, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-4', name: 'Astana Opera Theatre', lat: 51.13556, lng: 71.410917, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-5', name: 'Palace of Peace and Reconciliation', lat: 51.1269, lng: 71.4675, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-6', name: 'Independence Square / Kazakh Eli', lat: 51.1290, lng: 71.4600, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-7', name: 'Nurjol Boulevard', lat: 51.1280, lng: 71.4300, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-8', name: 'Astana Botanical Garden', lat: 51.1325, lng: 71.5100, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-9', name: 'Triumphal Arch M√§√±gilik El', lat: 51.1325, lng: 71.4500, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-10', name: 'Palace of Independence', lat: 51.1265, lng: 71.4680, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-11', name: 'Shabyt Palace of Creativity', lat: 51.1285, lng: 71.4450, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-12', name: 'National Museum of Kazakhstan', lat: 51.1290, lng: 71.4425, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-13', name: 'Astana Circus', lat: 51.1280, lng: 71.5200, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-14', name: 'Central Concert Hall', lat: 51.1320, lng: 71.4490, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-15', name: 'Duman Entertainment Center', lat: 51.1230, lng: 71.4700, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-16', name: 'Park of Lovers', lat: 51.1150, lng: 71.5000, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-17', name: 'Khan Shatyr', lat: 51.1280, lng: 71.4300, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-18', name: 'City Government District', lat: 51.1250, lng: 71.4450, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-19', name: 'Nur-Astana Mosque', lat: 51.126508, lng: 71.415574, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-20', name: 'Saryarka Velodrome', lat: 51.104722, lng: 71.405000, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-21', name: 'Qara√∂tkel Bridge', lat: 51.142110, lng: 71.481858, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-22', name: 'EXPO Nur Alem Sphere', lat: 51.1270, lng: 71.4270, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-23', name: 'Astana Arena Stadium', lat: 51.1100, lng: 71.4400, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-24', name: 'Atameken Map of Kazakhstan', lat: 51.1030, lng: 71.4830, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-25', name: 'Monument to Pushkin', lat: 51.1700, lng: 71.4270, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-26', name: 'Has Sanat Art Center', lat: 51.1350, lng: 71.4050, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-27', name: 'Russian Drama Theatre Gorky', lat: 51.1310, lng: 71.4180, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-28', name: 'Assumption Cathedral', lat: 51.1370, lng: 71.4300, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-29', name: 'Presidential Park', lat: 51.1270, lng: 71.4520, city: '–ê—Å—Ç–∞–Ω–∞' },
            { id: 'astana-30', name: 'Nur Alem Expo Area', lat: 51.1285, lng: 71.4180, city: '–ê—Å—Ç–∞–Ω–∞' },

            // –ê–õ–ú–ê–¢–´ (20 –º–µ—Å—Ç)
            { id: 'almaty-1', name: 'Medeu Ice Rink', lat: 43.157500, lng: 77.058611, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-2', name: 'Shymbulak Resort', lat: 43.128060, lng: 77.080830, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-3', name: 'Kok-Tobe Hill', lat: 43.233060, lng: 76.976110, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-4', name: 'Almaty TV Tower', lat: 43.228890, lng: 76.976110, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-5', name: 'Zenkov Cathedral', lat: 43.258611, lng: 76.953333, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-6', name: 'Panfilov Park', lat: 43.258833, lng: 76.953819, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-7', name: 'Big Almaty Lake', lat: 43.050600, lng: 76.985000, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-8', name: 'Republic Square', lat: 43.238330, lng: 76.945280, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-9', name: 'Central State Museum', lat: 43.235830, lng: 76.950830, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-10', name: 'Kasteev Art Museum', lat: 43.235600, lng: 76.919500, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-11', name: 'Green Bazaar', lat: 43.263611, lng: 76.953611, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-12', name: 'Botanical Garden', lat: 43.220000, lng: 76.915000, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-13', name: 'Arbat Pedestrian Street', lat: 43.2600, lng: 76.9500, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-14', name: 'First President Park', lat: 43.1927, lng: 76.8773, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-15', name: 'Dostyk Plaza', lat: 43.2361, lng: 76.9450, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-16', name: 'National Library', lat: 43.2420, lng: 76.9455, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-17', name: 'Almaty Opera and Ballet Theatre', lat: 43.2565, lng: 76.9430, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-18', name: 'Almaty Zoo', lat: 43.2483, lng: 76.9647, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-19', name: 'Almaty Botanical Garden East', lat: 43.2210, lng: 76.9220, city: '–ê–ª–º–∞—Ç—ã' },
            { id: 'almaty-20', name: 'Esentai Mall', lat: 43.2125, lng: 76.9150, city: '–ê–ª–º–∞—Ç—ã' },

            // –®–´–ú–ö–ï–ù–¢ (20 –º–µ—Å—Ç)
            { id: 'shymkent-1', name: 'Ordabasy Square', lat: 42.316600, lng: 69.594800, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-2', name: 'Shymkent Central Park', lat: 42.315900, lng: 69.603800, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-3', name: 'Baydibek Bi Monument', lat: 42.296900, lng: 69.631200, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-4', name: 'Independence Park', lat: 42.3144, lng: 69.6097, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-5', name: 'Abay Park', lat: 42.3110, lng: 69.5950, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-6', name: 'Shymkent Zoo', lat: 42.3192, lng: 69.6240, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-7', name: 'Shymkent Circus', lat: 42.3155, lng: 69.6095, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-8', name: 'Arboretum', lat: 42.3178, lng: 69.6212, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-9', name: 'Museum of Victims of Political Repression', lat: 42.3140, lng: 69.5995, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-10', name: 'Shymkent Museum of Fine Arts', lat: 42.3172, lng: 69.6040, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-11', name: 'Kenesary Khan Monument', lat: 42.3125, lng: 69.6025, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-12', name: 'Ken Baba Ethnic Park', lat: 42.3090, lng: 69.6100, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-13', name: 'Tauke Khan Avenue (main street POI)', lat: 42.3185, lng: 69.6000, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-14', name: 'Shymkent Plaza Mall', lat: 42.3220, lng: 69.6090, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-15', name: 'Kazhymukan Stadium', lat: 42.3120, lng: 69.6170, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-16', name: 'Regional Drama Theatre', lat: 42.3150, lng: 69.5975, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-17', name: 'Dendropark Entrance', lat: 42.3205, lng: 69.6180, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-18', name: 'Technopark Shymkent', lat: 42.3135, lng: 69.6155, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-19', name: 'Music Fountain Square', lat: 42.3170, lng: 69.6070, city: '–®—ã–º–∫–µ–Ω—Ç' },
            { id: 'shymkent-20', name: 'Al-Farabi Square', lat: 42.3160, lng: 69.6040, city: '–®—ã–º–∫–µ–Ω—Ç' },
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let userLocation = null;
        let coins = 0;
        let collectedPOIs = new Set();
        let isTracking = false;
        let watchId = null;
        let map = null;
        let markers = [];
        let userMarker = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadSavedData() {
            const savedCoins = localStorage.getItem('poi-coins');
            const savedCollected = localStorage.getItem('poi-collected');
            
            if (savedCoins) {
                coins = parseInt(savedCoins, 10);
                document.getElementById('coins').textContent = coins;
            }
            
            if (savedCollected) {
                collectedPOIs = new Set(JSON.parse(savedCollected));
                document.getElementById('collected-count').textContent = collectedPOIs.size;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('poi-coins', coins.toString());
            localStorage.setItem('poi-collected', JSON.stringify(Array.from(collectedPOIs)));
        }

        // –§–æ—Ä–º—É–ª–∞ Haversine –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lng2 - lng1) * Math.PI / 180;

            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                Math.cos(œÜ1) * Math.cos(œÜ2) *
                Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ—Ç—Ä–∞—Ö
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö POI
        function updateNearestPOIs(location) {
            const poisWithDistance = POI_DATA.map(poi => ({
                ...poi,
                distance: calculateDistance(location.lat, location.lng, poi.lat, poi.lng),
                collected: collectedPOIs.has(poi.id)
            }));

            const sortedPOIs = poisWithDistance
                .sort((a, b) => a.distance - b.distance)
                .slice(0, 10); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 10 –±–ª–∏–∂–∞–π—à–∏—Ö

            renderPOIList(sortedPOIs);
            updateMapMarkers(sortedPOIs);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            if (typeof google === 'undefined') {
                console.error('Google Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                showMapError('Google Maps API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
                return;
            }

            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            try {
                map = new google.maps.Map(mapElement, {
                    zoom: 15,
                    center: userLocation ? { lat: userLocation.lat, lng: userLocation.lng } : { lat: 51.1283, lng: 71.4305 },
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    styles: [
                        {
                            featureType: 'poi',
                            elementType: 'labels',
                            stylers: [{ visibility: 'off' }]
                        }
                    ]
                });
                
                console.log('–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã:', error);
                showMapError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã: ' + error.message);
            }
        }
        
        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏ –∫–∞—Ä—Ç—ã
        function showMapError(message) {
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = `
                    <div class="flex items-center justify-center h-full bg-red-50 border-2 border-red-200 rounded-lg">
                        <div class="text-center p-4">
                            <div class="text-red-600 text-4xl mb-2">‚ö†Ô∏è</div>
                            <div class="text-red-700 font-semibold mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã</div>
                            <div class="text-red-600 text-sm">${message}</div>
                            <div class="text-red-500 text-xs mt-2">
                                –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –≤ —Ñ–∞–π–ª–µ poi-collector-standalone.html
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ Google Maps API
        window.gm_authFailure = function() {
            console.error('Google Maps API: –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
            showMapError('API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –≤ Google Cloud Console.');
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateMapMarkers(pois) {
            if (!map) return;

            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è POI
            pois.forEach(poi => {
                const marker = new google.maps.Marker({
                    position: { lat: poi.lat, lng: poi.lng },
                    map: map,
                    title: poi.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: poi.collected ? 12 : 8,
                        fillColor: poi.collected ? '#10B981' : (poi.distance && poi.distance <= 50 ? '#F59E0B' : '#EF4444'),
                        fillOpacity: 1,
                        strokeColor: '#FFFFFF',
                        strokeWeight: 2,
                    },
                    zIndex: poi.collected ? 100 : 50
                });

                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–∫–Ω–æ
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div class="p-2">
                            <h3 class="font-semibold text-gray-800">${poi.name}</h3>
                            <p class="text-sm text-gray-600">${poi.city}</p>
                            ${poi.distance ? `<p class="text-sm text-gray-500">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${Math.round(poi.distance)}–º</p>` : ''}
                            ${poi.collected ? '<p class="text-green-600 font-medium">‚úÖ –°–æ–±—Ä–∞–Ω–æ</p>' : ''}
                            ${poi.distance && poi.distance <= 50 && !poi.collected ? '<p class="text-yellow-600 font-medium">–ë–ª–∏–∑–∫–æ! +10 –∫–æ–∏–Ω–æ–≤</p>' : ''}
                        </div>
                    `
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                markers.push(marker);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserMarker(location) {
            if (!map) return;

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–∞—Ä–∫–µ—Ä
            if (userMarker) {
                userMarker.setMap(null);
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userMarker = new google.maps.Marker({
                position: { lat: location.lat, lng: location.lng },
                map: map,
                title: '–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 8,
                    fillColor: '#4285F4',
                    fillOpacity: 1,
                    strokeColor: '#FFFFFF',
                    strokeWeight: 2,
                },
                zIndex: 1000
            });

            // –ö—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏
            const accuracyCircle = new google.maps.Circle({
                strokeColor: '#4285F4',
                strokeOpacity: 0.3,
                strokeWeight: 1,
                fillColor: '#4285F4',
                fillOpacity: 0.1,
                map: map,
                center: { lat: location.lat, lng: location.lng },
                radius: location.accuracy
            });

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
            map.setCenter({ lat: location.lat, lng: location.lng });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ POI
        function renderPOIList(pois) {
            const container = document.getElementById('poi-list');
            
            if (pois.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –º–µ—Å—Ç...</div>';
                return;
            }

            container.innerHTML = pois.map(poi => `
                <div class="p-4 rounded-lg border-2 transition-colors cursor-pointer hover:shadow-md ${
                    poi.collected
                        ? 'bg-green-50 border-green-200'
                        : poi.distance <= 50
                        ? 'bg-yellow-50 border-yellow-200'
                        : 'bg-gray-50 border-gray-200'
                }" onclick="centerMapOnPOI(${poi.lat}, ${poi.lng})">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800">
                                ${poi.name}
                                ${poi.collected ? '<span class="ml-2 text-green-600">‚úÖ</span>' : ''}
                            </h3>
                            <p class="text-sm text-gray-600">${poi.city}</p>
                        </div>
                        
                        <div class="text-right">
                            <div class="text-lg font-bold ${
                                poi.collected
                                    ? 'text-green-600'
                                    : poi.distance <= 50
                                    ? 'text-yellow-600'
                                    : 'text-gray-600'
                            }">
                                ${Math.round(poi.distance)}–º
                            </div>
                            ${poi.distance <= 50 && !poi.collected ? 
                                '<div class="text-xs text-yellow-600 font-medium">–ë–ª–∏–∑–∫–æ! +10 –∫–æ–∏–Ω–æ–≤</div>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –Ω–∞ POI
        function centerMapOnPOI(lat, lng) {
            if (map) {
                map.setCenter({ lat: lat, lng: lng });
                map.setZoom(18);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–±–æ—Ä –∫–æ–∏–Ω–æ–≤
        function checkForCoinCollection(location) {
            POI_DATA.forEach(poi => {
                if (collectedPOIs.has(poi.id)) return; // –£–∂–µ —Å–æ–±—Ä–∞–Ω–æ

                const distance = calculateDistance(location.lat, location.lng, poi.lat, poi.lng);
                
                if (distance <= 50) { // –í —Ä–∞–¥–∏—É—Å–µ 50 –º–µ—Ç—Ä–æ–≤
                    coins += 10;
                    collectedPOIs.add(poi.id);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    document.getElementById('coins').textContent = coins;
                    document.getElementById('collected-count').textContent = collectedPOIs.size;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification(`‚úÖ –í—ã –ø–æ–ª—É—á–∏–ª–∏ +10 –∫–æ–∏–Ω–æ–≤ –∑–∞ ${poi.name}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    saveData();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ POI
                    updateNearestPOIs(location);
                }
            });
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.classList.remove('hidden');
            notification.classList.add('animate-bounce');
            
            setTimeout(() => {
                notification.classList.add('hidden');
                notification.classList.remove('animate-bounce');
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        function handleLocationSuccess(position) {
            userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
            document.getElementById('location-info').innerHTML = `
                <div>–®–∏—Ä–æ—Ç–∞: ${userLocation.lat.toFixed(6)}</div>
                <div>–î–æ–ª–≥–æ—Ç–∞: ${userLocation.lng.toFixed(6)}</div>
                <div class="text-xs text-gray-500">
                    –¢–æ—á–Ω–æ—Å—Ç—å: ¬±${Math.round(userLocation.accuracy)}–º
                </div>
            `;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            document.getElementById('location-error').classList.add('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
            updateUserMarker(userLocation);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º POI –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä –∫–æ–∏–Ω–æ–≤
            updateNearestPOIs(userLocation);
            checkForCoinCollection(userLocation);
        }

        function handleLocationError(error) {
            let errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é';
            
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                    break;
                case error.TIMEOUT:
                    errorMessage = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏—Å—Ç–µ–∫–ª–æ';
                    break;
            }
            
            document.getElementById('error-text').textContent = errorMessage;
            document.getElementById('location-error').classList.remove('hidden');
        }

        // –ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
        function startTracking() {
            if (!navigator.geolocation) {
                document.getElementById('error-text').textContent = '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º';
                document.getElementById('location-error').classList.remove('hidden');
                return;
            }

            isTracking = true;
            document.getElementById('tracking-status').textContent = '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ - –ø—Ä–∏–±–ª–∏–∂–∞–π—Ç–µ—Å—å –∫ —Ç–æ—á–∫–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–∞!';
            document.getElementById('start-tracking').classList.add('hidden');
            document.getElementById('stop-tracking').classList.remove('hidden');

            watchId = navigator.geolocation.watchPosition(
                handleLocationSuccess,
                handleLocationError,
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
        function stopTracking() {
            isTracking = false;
            document.getElementById('tracking-status').textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ" –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–∏–Ω–æ–≤';
            document.getElementById('start-tracking').classList.remove('hidden');
            document.getElementById('stop-tracking').classList.add('hidden');
            
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Google Maps API
            if (typeof google !== 'undefined') {
                initMap();
            } else {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Google Maps API
                window.addEventListener('load', initMap);
            }
            
            document.getElementById('start-tracking').addEventListener('click', startTracking);
            document.getElementById('stop-tracking').addEventListener('click', stopTracking);
        });
    </script>
</body>
</html>
